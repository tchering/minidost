<% if current_user == user %>
  <div class="notification-wrapper position-relative" data-controller="notifications">
    <button class="btn btn-outline-primary btn-sm rounded-3 d-inline-flex align-items-center" 
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            data-bs-auto-close="outside"
            data-notifications-target="button">
      <div class="d-flex align-items-center">
        <i class="fas fa-bell opacity-75 me-2"></i>
      </div>
      <% if current_user.notifications.unread.count.positive? %>
        <span class="notification-badge" data-notifications-target="badge">
          <%= current_user.notifications.unread.count %>
        </span>
      <% end %>
    </button>

    <div class="dropdown-menu dropdown-menu-start notification-dropdown" style="position: absolute; right: 0; width: 320px; max-height: 400px; overflow-y: auto;">
      <div class="notification-header d-flex justify-content-between align-items-center p-3 border-bottom">
        <h6 class="mb-0"><%= t('notifications.title', default: 'Notifications') %></h6>
        <% if current_user.notifications.unread.any? %>
          <%= link_to mark_all_as_read_notifications_path, 
              class: "text-decoration-none", 
              data: { turbo_method: :patch } do %>
            <small><%= t('notifications.mark_all_as_read') %></small>
          <% end %>
        <% end %>
      </div>

      <div class="notification-list" data-notifications-target="list">
        <% notifications.each do |notification| %>
          <%= link_to notification_path(notification), 
              class: "dropdown-item notification-item #{notification.read_at.nil? ? 'unread' : ''}", 
              data: { 
                turbo_method: :patch,
                action: "click->notifications#handleNotificationClick",
                notification_id: notification.id,
                sender_id: notification.try(:sender_id),
                conversation_id: notification.try(:conversation_id)
              } do %>
            <div class="d-flex align-items-center">
              <div class="me-2">
                <%= notification_icon(notification) %>
              </div>
              <div class="notification-content flex-grow-1">
                <p class="notification-text mb-1"><%= notification_text(notification) %></p>
                <small class="text-muted"><%= time_ago_in_words(notification.created_at) %> ago</small>
              </div>
            </div>
          <% end %>
        <% end %>

        <% if notifications.empty? %>
          <div class="dropdown-item text-center text-muted py-3">
            <small><%= t('notifications.no_notifications') %></small>
          </div>
        <% end %>
      </div>

      
    </div>
  </div>
<% end %>
