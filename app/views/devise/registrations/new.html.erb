<% # encoding: utf-8 %>
<div class="registration-container">
  <div class="registration-card">
    <div class="registration-header">
      <h2 class="header-title">
        <i class="fas fa-building me-2"></i>
        <%= t('registration.create_business_account') %>
      </h2>
    </div>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: "registration-form" }) do |f| %>
      <%= render "devise/shared/error_messages", resource: resource %>
      
      <%# Company Information Section %>
      <div class="form-section">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-briefcase me-2"></i>
            <%= t('registration.company_info') %>
          </h3>
        </div>
        
        <div class="form-grid">
          <div class="col-md-4">
            <%= f.label :legal_status, class: "form-label required" %>
            <%= f.select :legal_status, SelectOption::LEGAL_STATUS, {}, class: "form-select form-control-md" %>
            <div class="text-danger"><%= f.object.errors[:legal_status].join(", ") %></div>
          </div>
          <div class="col-md-4 mb-3">
            <%= f.label :company_name, class: "form-label required" %>
            <%= f.text_field :company_name, placeholder: "Company Name", class: "form-control form-control-lg" %>
            <div class="text-danger"><%= f.object.errors[:company_name].join(", ") %></div>
          </div>
          <div class="col-md-4">
            <%#to First element (t('positions.contractor')) - what users see in the dropdown %>
            <%#to Second element ("contractor") - the actual value that gets stored in database %>
            <%= f.label :position, class: "form-label" %>
            <%= f.select :position, 
                        [
                          [t('positions.contractor'), "contractor"],
                          [t('positions.subcontractor'), "sub-contractor"]
                        ], 
                        {}, 
                        class: "form-select form-control-md" %>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :establishment_date, class: "form-label" %>
            <%= f.select :establishment_date,
                         Range.new((Time.zone.now.year - 100), (Time.zone.now.year)).to_a.reverse,
                         {}, class: "form-select" %>
          </div>
          <div class="col-md-6">
            <%= f.label :activity_sector, class: "form-label" %>
            <%= f.select :activity_sector, 
                grouped_options_for_select(SelectOption.translated_sectors), {},  class: "form-select" %>
          </div>
        </div>

        <%# Address Section %>
        <div class="address-section">
          <h4 class="subsection-title">
            <i class="fas fa-map-marker-alt me-2"></i>
            <%= t('registration.company_address') %>
          </h4>
          
          <div data-controller="address-autocomplete" 
               data-address-autocomplete-api-key-value="<%= Rails.application.credentials.mapbox[:api_key] %>">
            <div class="row">
              <div class="col-6 mb-3 position-relative">
                <%= f.label :street, class: "form-label" %>
                <%= f.text_field :street, 
                   placeholder: "Street", 
                   class: "form-control",
                   data: { address_autocomplete_target: "street",
                                         action: "input->address-autocomplete#search" } %>
                <div class="text-danger"><%= f.object.errors[:street].join(", ") %></div>
                <%# Autocomplete results container %>
                <div data-address-autocomplete-target="results" 
                    class="position-absolute w-100 mt-1 rounded shadow-sm bg-white" 
                    style="z-index: 1000; display: none;">
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <%= f.label :area_code, class: "form-label" %>
                <%= f.text_field :area_code, 
                                placeholder: "Zip Code", 
                                class: "form-control",
                                 data: { address_autocomplete_target: "areaCode" } %>
                <div class="text-danger"><%= f.object.errors[:area_code].join(", ") %></div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <%= f.label :city, class: "form-label" %>
                <%= f.text_field :city, 
                 placeholder: "City", 
                 class: "form-control",
                 data: { address_autocomplete_target: "city" } %>
                <div class="text-danger"><%= f.object.errors[:city].join(", ") %></div>
              </div>
              <div class="col-6 mb-3">
                <%= f.label :logo %>
                <%= f.file_field :logo, class: "form-control" %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# Personal Information Section %>
      <div class="form-section">
        <div class="section-header">
          <h3 class="section-title">
            <i class="fas fa-user me-2"></i>
            <%= t('registration.personal_info') %>
          </h3>
        </div>
        
        <div class="form-grid">
          <div class="col-md-6 mb-3">
            <%= f.label :first_name, class: "form-label" %>
            <%= f.text_field :first_name, autofocus: true, autocomplete: "first_name", class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:first_name].join(", ") %></div>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :last_name, class: "form-label" %>
            <%= f.text_field :last_name, autocomplete: "last_name", class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:last_name].join(", ") %></div>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :email, class: "form-label" %>
            <%= f.email_field :email, autocomplete: "email", class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:email].join(", ") %></div>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :phone_number, class: "form-label" %>
            <%= f.text_field :phone_number, class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:phone_number].join(", ") %></div>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :password, class: "form-label" %>
            <% if @minimum_password_length %>
              <small class="text-muted">(<%= @minimum_password_length %> characters minimum)</small>
            <% end %>
            <%= f.password_field :password, autocomplete: "new-password", class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:password].join(", ") %></div>
          </div>
          <div class="col-md-6 mb-3">
            <%= f.label :password_confirmation, class: "form-label" %>
            <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "form-control" %>
            <div class="text-danger"><%= f.object.errors[:password_confirmation].join(", ") %></div>
          </div>
        </div>
      </div>

      <%# Submit Button %>
      <div class="form-actions">
        <%= f.submit t('registration.create_account'), class: "submit-button" %>
      </div>
    <% end %>

    <%# Links %>
    <div class="auth-links">
      <p class="text-muted"><%= t('registration.already_have_account') %></p>
      <%= render "devise/shared/links" %>
    </div>
  </div>
</div>

<style>
.registration-container {
  padding: 2rem 1.5rem;
  background: #f8fafc;
  min-height: 100vh;
}

.registration-card {
  max-width: 1000px;
  margin: 0 auto;
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.registration-header {
  background: linear-gradient(135deg, #1a5f7a 0%, #2563eb 100%);
  padding: 1.5rem;
  color: white;
  text-align: center;
}

.header-title {
  font-size: 1.5rem;
  font-weight: 600;
  margin: 0;
}

.registration-form {
  padding: 2rem;
}

.form-section {
  background: #f8fafc;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.section-header {
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid #e2e8f0;
}

.section-title {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1e293b;
  margin: 0;
}

.subsection-title {
  font-size: 1rem;
  font-weight: 600;
  color: #64748b;
  margin: 1.5rem 0 1rem;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.form-control, .form-select {
  border: 2px solid #e2e8f0;
  border-radius: 8px;
  padding: 0.75rem;
  font-size: 0.875rem;
  transition: all 0.2s ease;
}

.form-control:focus, .form-select:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-label {
  font-size: 0.875rem;
  font-weight: 500;
  color: #475569;
  margin-bottom: 0.5rem;
}

.form-label.required::after {
  content: "*";
  color: #ef4444;
  margin-left: 0.25rem;
}

.form-actions {
  margin-top: 2rem;
  text-align: center;
}

.submit-button {
  background: linear-gradient(135deg, #1e40af, #3b82f6);
  color: white;
  border: none;
  padding: 1rem 3rem;
  border-radius: 12px;
  font-weight: 600;
  transition: all 0.3s ease;
  cursor: pointer;
}

.submit-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.auth-links {
  text-align: center;
  padding: 2rem;
  background: #f8fafc;
  border-top: 1px solid #e2e8f0;
}

.text-danger {
  color: #ef4444;
  font-size: 0.75rem;
  margin-top: 0.25rem;
}

@media (max-width: 768px) {
  .registration-container {
    padding: 1rem;
  }

  .registration-form {
    padding: 1rem;
  }

  .form-section {
    padding: 1rem;
  }

  .form-grid {
    grid-template-columns: 1fr;
  }
}
</style>
